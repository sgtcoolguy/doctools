<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>ListView Binding</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta content="Scroll EclipseHelp Exporter" name="generator">

    <link type="text/css" rel="stylesheet" href="css/eclipse-defaults.css">
    <link type="text/css" rel="stylesheet" href="css/common.css">
    <link type="text/css" rel="stylesheet" href="css/print.css" media="print">
</head>
<body>
    <div class="container">
        <div class="header"></div>

        <div id="src-41845706" class="content">
                        <h1>ListView Binding</h1>
    <p>Demonstrates using binding a data collection to a ListView and applying different list item templates to each list item using a data transformer.    </p>
    <div class="confbox admonition admonition-info aui-message hint shadowed information-macro has-no-icon">
            <div class="title">App Folder Location</div>
            <p>alloy/test/apps/<strong class=" ">models/binding_listview</strong>    </p>
    </div>
        <p>The application defines three list item templates: one with just a title, one with a title and subtitle, and one with a title, subtitle and image.    </p>
    <p>    <img src="images/download/attachments/41845706/screenshot.png" alt="images/download/attachments/41845706/screenshot.png" class="confluence-embedded-image confluence-content-image-border" width="240">
        </p>
    <p>The main index.xml view defines three <tt class=" ">&lt;ItemTemplate/&gt;</tt> elements &#x2013; &quot;fullItem&quot;, &quot;titleAndSub&quot;, and &quot;title&quot; &#x2013; that define the various UI elements. The <tt class=" ">bindId</tt> attribute assigned to each UI element specifies the name used to assign data to it at runtime. The <tt class=" ">&lt;ListSection/&gt;</tt> element contains a single <tt class=" ">&lt;ListItem/&gt;</tt> element whose <tt class=" ">template</tt> attribute is set to the value &quot;{{<tt class=" ">template</tt>}}&quot;. It includes attributes whose names correspond to the three possible template UI elements: &quot;title&quot;, &quot;subtitle&quot; and &quot;image&quot;. The <tt class=" ">ListSection</tt> element is bound to the <tt class=" ">info</tt> collection and specifies a <tt class=" ">dataTransform</tt> function named <tt class=" ">doTransform()</tt>.    </p>
    <div class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">app/views/index.xml</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="app/views/index.xml">
<div class="line"><code class="plain">&lt;ListView id=</code><code class="string">&quot;list&quot;</code><code class="plain"> defaultItemTemplate=</code><code class="string">&quot;title&quot;</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">    &lt;Templates&gt;</code></div>
<div class="line"><code class="plain">        &lt;ItemTemplate name=</code><code class="string">&quot;fullItem&quot;</code><code class="plain"> height=</code><code class="string">&quot;70&quot;</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">            &lt;ImageView bindId=</code><code class="string">&quot;image&quot;</code><code class="plain"> </code><code class="keyword">class</code><code class="plain">=</code><code class="string">&quot;image&quot;</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">            &lt;Label bindId=</code><code class="string">&quot;title&quot;</code><code class="plain"> </code><code class="keyword">class</code><code class="plain">=</code><code class="string">&quot;title text-and-image&quot;</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">            &lt;Label bindId=</code><code class="string">&quot;subtitle&quot;</code><code class="plain"> </code><code class="keyword">class</code><code class="plain">=</code><code class="string">&quot;subtitle text-and-image&quot;</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">        &lt;/ItemTemplate&gt;</code></div>
<div class="line"><code class="plain">        &lt;ItemTemplate name=</code><code class="string">&quot;titleAndSub&quot;</code><code class="plain"> height=</code><code class="string">&quot;70&quot;</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">            &lt;Label bindId=</code><code class="string">&quot;title&quot;</code><code class="plain"> </code><code class="keyword">class</code><code class="plain">=</code><code class="string">&quot;title&quot;</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">            &lt;Label bindId=</code><code class="string">&quot;subtitle&quot;</code><code class="plain"> </code><code class="keyword">class</code><code class="plain">=</code><code class="string">&quot;subtitle&quot;</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">        &lt;/ItemTemplate&gt;</code></div>
<div class="line"><code class="plain">        &lt;ItemTemplate name=</code><code class="string">&quot;title&quot;</code><code class="plain"> height=</code><code class="string">&quot;50&quot;</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">            &lt;Label bindId=</code><code class="string">&quot;title&quot;</code><code class="plain"> </code><code class="keyword">class</code><code class="plain">=</code><code class="string">&quot;title&quot;</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">        &lt;/ItemTemplate&gt;</code></div>
<div class="line"><code class="plain">    &lt;/Templates&gt;</code></div>
<div class="line"><code class="plain">    &lt;ListSection id=</code><code class="string">&quot;section&quot;</code><code class="plain"> dataCollection=</code><code class="string">&quot;info&quot;</code><code class="plain"> dataTransform=</code><code class="string">&quot;doTransform&quot;</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">        &lt;ListItem template=</code><code class="string">&quot;{template}&quot;</code><code class="plain"> title:text=</code><code class="string">&quot;{title}&quot;</code><code class="plain"> subtitle:text=</code><code class="string">&quot;{subtitle}&quot;</code><code class="plain"> image:image=</code><code class="string">&quot;{image}&quot;</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">    &lt;/ListSection&gt;</code></div>
<div class="line"><code class="plain">&lt;/ListView&gt;</code></div>
</div>
    </div>
    <p>When the user clicks a toolbar button, the <tt class=" ">doButtonClick()</tt> is called, which adds a new model to the info collection, and persists it to the SQLite database. The model is initialized with a unique data object, depending on which button was clicked. The <tt class=" ">doTransform()</tt> then assigns the correct template to the model depending on its data structure, and returns the updated model for display.    </p>
    <div class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">app/controllers/index.js</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="app/controllers/index.js">
<div class="line"><code class="comments">// assign a ListItem template based on the contents of the model</code></div>
<div class="line"><code class="plain">function doTransform(model) {</code></div>
<div class="line"><code class="plain">    var o = model.toJSON();</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (o.subtitle) {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (o.image) {</code></div>
<div class="line"><code class="plain">            o.template = </code><code class="string">&apos;fullItem&apos;</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        } </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">            o.template = </code><code class="string">&apos;titleAndSub&apos;</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    } </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">        o.template = </code><code class="string">&apos;title&apos;</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> o;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="comments">// Handle the buttonClick event triggered from the button controller.</code></div>
<div class="line"><code class="comments">// Notice that we will be updating the ListView UI without referring</code></div>
<div class="line"><code class="comments">// directly to the ListView itself, only by modifying its data model.</code></div>
<div class="line"><code class="plain">function doButtonClick(e) {</code></div>
<div class="line"><code class="plain">    alert(e);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (_.isEmpty(e.modelObj)) {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// use a custom query to quickly empty the SQLite store</code></div>
<div class="line"><code class="plain">        var db = Ti.Database.open(</code><code class="string">&apos;_alloy_&apos;</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        db.execute(</code><code class="string">&apos;DELETE FROM info;&apos;</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        db.close();</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// refresh the collection to reflect this in the UI</code></div>
<div class="line"><code class="plain">        info.fetch();</code></div>
<div class="line"><code class="plain">    } </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// create a model for the listitem</code></div>
<div class="line"><code class="plain">        var model = Alloy.createModel(</code><code class="string">&apos;info&apos;</code><code class="plain">, e.modelObj);</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// add model to collection which will in turn update the UI</code></div>
<div class="line"><code class="plain">        info.add(model);</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// save the model to SQLite</code></div>
<div class="line"><code class="plain">        model.save();</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    <p>The application models/info.js defines a a data model with four fields: id, title, subtitle, and image. It also specifies SQL as the persistence adaptor, and the collection name as &quot;info&quot;.    </p>
    <div class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">app/models/info.js</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="app/models/info.js">
<div class="line"><code class="plain">exports.definition = {</code></div>
<div class="line"><code class="plain">    config: {</code></div>
<div class="line"><code class="plain">        columns: {</code></div>
<div class="line"><code class="plain">            id: &apos;INTEGER PRIMARY KEY AUTOINCREMENT&apos;,</code></div>
<div class="line"><code class="plain">            title: &apos;TEXT&apos;,</code></div>
<div class="line"><code class="plain">            subtitle: &apos;TEXT&apos;,</code></div>
<div class="line"><code class="plain">            image: &apos;TEXT&apos;</code></div>
<div class="line"><code class="plain">        },</code></div>
<div class="line"><code class="plain">        adapter: {</code></div>
<div class="line"><code class="plain">            type: &apos;sql&apos;,</code></div>
<div class="line"><code class="plain">            collection_name: &apos;info&apos;,</code></div>
<div class="line"><code class="plain">            idAttribute: &apos;id&apos;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
    </div>
    <div class="section section-2 " id="src-41845706_ListViewBinding-SeeAlso">
        <h2 class="heading "><span>See Also</span></h2>
<ul class=" "><li class=" ">    <p><a class="document-link unresolved" href="ListView_Binding.html#src-41845706">Alloy ListView Guide</a>    </p>
</li><li class=" ">    <p><a class="external-link external-link" href="http://docs.appcelerator.com/titanium/3.0/#!/api/Titanium.UI.ListView">Titanium.UI.ListView API reference</a>    </p>
</li></ul>    <p>    </p>
    <p>    </p>
    </div>
        </div>
    
        
    </div>
</body>
</html>
