<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Build Test and Deploy a Titanium Cross-Platform App with Fastlane</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta content="Scroll EclipseHelp Exporter" name="generator">

    <link type="text/css" rel="stylesheet">
    <link type="text/css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" media="print">
</link></link></link></meta></meta></head>
<body>
    <div class="container">
        <div class="header"/>

        <div id="src-56296174" class="content">
                        <h1>Build Test and Deploy a Titanium Cross-Platform App with Fastlane</h1>
    <p>    </p>
<ul class="toc-indentation "><li class=" ">    <p><a class="document-link " href="#!/guide/Build_Test_and_Deploy_a_Titanium_Cross-Platform_App_with_Fastlane-section-src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-Testing">Testing</a>    </p>
<ul class="toc-indentation "><li class=" ">    <p><a class="document-link " href="#!/guide/Build_Test_and_Deploy_a_Titanium_Cross-Platform_App_with_Fastlane-section-src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-SetupAppiumServer">Set up Appium Server</a>    </p>
</li><li class=" ">    <p><a class="document-link " href="#!/guide/Build_Test_and_Deploy_a_Titanium_Cross-Platform_App_with_Fastlane-section-src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-InstallMocha">Install Mocha</a>    </p>
</li><li class=" ">    <p><a class="document-link " href="#!/guide/Build_Test_and_Deploy_a_Titanium_Cross-Platform_App_with_Fastlane-section-src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-CreateMochaTestFileforYourApp">Create Mocha Test File for Your App</a>    </p>
</li></ul></li><li class=" ">    <p><a class="document-link " href="#!/guide/Build_Test_and_Deploy_a_Titanium_Cross-Platform_App_with_Fastlane-section-src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-Automation">Automation</a>    </p>
<ul class="toc-indentation "><li class=" ">    <p><a class="document-link " href="#!/guide/Build_Test_and_Deploy_a_Titanium_Cross-Platform_App_with_Fastlane-section-src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-InstallFastlane">Install Fastlane</a>    </p>
</li><li class=" ">    <p><a class="document-link " href="#!/guide/Build_Test_and_Deploy_a_Titanium_Cross-Platform_App_with_Fastlane-section-src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-ConfigureFastlane">Configure Fastlane</a>    </p>
</li><li class=" ">    <p><a class="document-link " href="#!/guide/Build_Test_and_Deploy_a_Titanium_Cross-Platform_App_with_Fastlane-section-src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-CustomizeYourFastfile">Customize Your Fastfile</a>    </p>
</li><li class=" ">    <p><a class="document-link " href="#!/guide/Build_Test_and_Deploy_a_Titanium_Cross-Platform_App_with_Fastlane-section-src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-ExecuteFastlane">Execute Fastlane</a>    </p>
</li></ul></li></ul>    <p>Developing a mobile app is just the beginning. What follows &#x2013; signing, packaging, managing app meta data, testing, and deploying to the App Stores, can arguably be just as tedious and challenging.This document will demonstrate one way to configure your environment to manage several build, test, and deployment tasks when developing apps with Titanium using Appium and Fastlane.We&apos;ll use <a class="external-link external-link" href="http://appium.io/" target="_blank">Appium (Local Server)</a> and <a class="external-link external-link" href="https://www.npmjs.com/package/mocha" target="_blank">mocha</a> (npm package) for testing and <a class="external-link external-link" href="https://fastlane.tools/" target="_blank">fastlane</a> for automation.    </p>
    <div class="section section-2 " id="src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-Testing">
        <h2 class="heading "><span>Testing</span></h2>
    <div class="section section-3 " id="src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-SetupAppiumServer">
        <h3 class="heading "><span>Set up Appium Server</span></h3>
    <p><a class="external-link external-link" href="https://appium.io/" target="_blank">Appium</a> is an open source test automation framework for use with native, hybrid, and mobile web apps. There are several options here that range from cloud-based, to local node package, and even a simple &#x2018;Appium Desktop&#x2019; GUI app for Mac. For this document, we are going to use the simple GUI-based app, as it does everything we need it to do.    </p>
<ol class=" "><li class=" ">    <p>Download the free <a class="external-link external-link" href="https://github.com/appium/appium-desktop/releases/tag/v1.5.0" target="_blank">Appium Desktop App</a>.    </p>
</li><li class=" ">    <p>Validate all required Appium dependencies.    </p>
</li><li class=" ">    <p>Install and run <tt class=" ">Appium Doctor</tt>. This wizard will validate and advise of any additional steps or dependencies that may be needed for your environment. More info can be found <a class="external-link external-link" href="https://appium.io/docs/en/about-appium/getting-started/?lang=en" target="_blank">here</a>.<br><tt class=" ">npm install -g appium-doctor</tt><tt class=" ">appium-doctor</tt>    </br></p>
<ol class=" "><li class=" ">    <p>Follow any steps to install any packages that your environment may be missing.    </p>
</li></ol></li><li class=" ">    <p>Launch the Appium (Server) app and start the &#x201C;Simple&#x201D; Server using the defaults.    </p>
</li></ol>    </div>
    <div class="section section-3 " id="src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-InstallMocha">
        <h3 class="heading "><span>Install Mocha</span></h3>
    <p>Since most developers  manage multiple mobile applications, you should chose to manage tests for each app in a single JavaScript file and all app JavaScript files within a single folder outside of the Appcelerator Project directory. There are numerous ways you can manage this and there is no right or wrong just more of a preference. One example structure may look like this:    </p>
<ul class=" "><li class=" ">    <p>Documents    </p>
</li><li class=" ">    <p>Appium_Tests    </p>
</li><li class=" ">    <p>firstapp_test.js    </p>
</li><li class=" ">    <p>anotherapp_test.js    </p>
</li><li class=" ">    <p>...    </p>
</li></ul>    <p>Depending on your preference, install mocha either globally or locally in your tests directory (&#x2018;Appium_Tests&#x2019; in this example):    </p>
    <p><tt class=" ">npm install --global mocha</tt>    </p>
    </div>
    <div class="section section-3 " id="src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-CreateMochaTestFileforYourApp">
        <h3 class="heading "><span>Create Mocha Test File for Your App</span></h3>
    <p>This file will use an &#x201C;appium client&#x201D; to connect to your Appium Server to run the automated tests. There are several clients to use and each have their own pros and cons. The general consensus is that <tt class=" ">webdriver io</tt> is the preferred client. If you&#x2019;d like to see the other options and/or see more complex examples, check out <a class="external-link external-link" href="https://github.com/appium/sample-code/tree/master/sample-code/examples/node" target="_blank">this repo of examples</a>.    </p>
    <p>First, create a test file and name it <tt class=" ">firstapp_test.js</tt>.    </p>
    <p>Next, copy the following block of code into your file:    </p>
<ul class=" "><li class=" ">    <p>port# must match your Appium Server Port.    </p>
</li><li class=" ">    <p>Simulator can be customized to match your needs, but the same choice will need to be used when we build from fastlane (set up later in this document).    </p>
</li><li class=" ">    <p>Update the path to your built app. <strong class=" ">Note</strong>: In this document, we are pointing to the app built for the simulator. You can also test against physical devices, but we aren&#x2019;t covering that here.    </p>
</li></ul>    <div class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="string">&quot;use strict&quot;</code><code class="plain">;</code></div>
<div class="line">&#xA0;</div>
<div class="line"><code class="plain">const opts = {</code></div>
<div class="line"><code class="plain">  port: 4723,</code></div>
<div class="line"><code class="plain">  desiredCapabilities: {</code></div>
<div class="line"><code class="plain">    	</code><code class="string">&quot;platformName&quot;</code><code class="plain">: </code><code class="string">&quot;iOS&quot;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  		</code><code class="string">&quot;platformVersion&quot;</code><code class="plain">: </code><code class="string">&quot;11.2&quot;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  		</code><code class="string">&quot;deviceName&quot;</code><code class="plain">: </code><code class="string">&quot;iPad Pro (12.9-inch) (2nd generation)&quot;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  		</code><code class="string">&quot;app&quot;</code><code class="plain">: </code><code class="string">&quot;/Users/{USERDIR}/Documents/Appcelerator_Studio_Workspace/DASH/build/iphone/build/Products/Debug-iphonesimulator/MyAppName.app&quot;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    	</code><code class="string">&quot;automationName&quot;</code><code class="plain">: </code><code class="string">&quot;XCUITest&quot;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">        </code><code class="string">&quot;noReset&quot;</code><code class="plain">: </code><code class="keyword">true</code></div>
<div class="line"><code class="plain">  }</code></div>
<div class="line"><code class="plain">};</code></div>
<div class="line">&#xA0;</div>
<div class="line"><code class="keyword">var</code><code class="plain"> wd = require(</code><code class="string">&quot;webdriverio&quot;</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">describe(</code><code class="string">&quot;FIRST APP TEST&quot;</code><code class="plain">, </code><code class="keyword">function</code><code class="plain"> () {</code></div>
<div class="line"><code class="plain">  </code><code class="keyword">this</code><code class="plain">.timeout(300000);</code></div>
<div class="line"><code class="plain">  </code><code class="keyword">var</code><code class="plain"> driver;</code></div>
<div class="line"><code class="plain">  </code><code class="keyword">var</code><code class="plain"> allPassed = </code><code class="keyword">true</code><code class="plain">;</code></div>
<div class="line">&#xA0;</div>
<div class="line"><code class="plain">  before(</code><code class="keyword">function</code><code class="plain"> () {</code></div>
<div class="line"><code class="plain">    driver = wd.remote(opts);</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> driver.init();</code></div>
<div class="line"><code class="plain">  });</code></div>
<div class="line">&#xA0;</div>
<div class="line"><code class="plain">  after(</code><code class="keyword">function</code><code class="plain"> () {</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> driver</code></div>
<div class="line"><code class="plain">      .end()</code></div>
<div class="line"><code class="plain">  });</code></div>
<div class="line">&#xA0;</div>
<div class="line"><code class="plain">  afterEach(</code><code class="keyword">function</code><code class="plain"> () {</code></div>
<div class="line"><code class="plain">    allPassed = allPassed &amp;&amp; </code><code class="keyword">this</code><code class="plain">.currentTest.state === </code><code class="string">&apos;passed&apos;</code><code class="plain">;</code></div>
<div class="line"><code class="plain">  });</code></div>
<div class="line">&#xA0;</div>
<div class="line"><code class="plain">   it(</code><code class="string">&quot;Should Login&quot;</code><code class="plain">, </code><code class="keyword">function</code><code class="plain"> () {</code></div>
<div class="line"><code class="plain">    	</code><code class="keyword">return</code><code class="plain"> driver</code></div>
<div class="line"><code class="plain">    	.element(</code><code class="string">&quot;~Enter Username&quot;</code><code class="plain">).setValue(</code><code class="string">&quot;testusername&quot;</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    	.element(</code><code class="string">&quot;~Enter Password&quot;</code><code class="plain">).setValue(</code><code class="string">&quot;testpassword&quot;</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    	.click(</code><code class="string">&quot;~Attempting to Log In&quot;</code><code class="plain">)</code></div>
<div class="line"><code class="plain">  });</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">  it(</code><code class="string">&quot;Should Do Something else&quot;</code><code class="plain">, </code><code class="keyword">function</code><code class="plain"> () {</code></div>
<div class="line"><code class="plain">    	</code><code class="keyword">return</code><code class="plain"> driver</code></div>
<div class="line"><code class="plain">    	</code><code class="comments">//Do another test here</code></div>
<div class="line"><code class="plain">  });</code></div>
<div class="line">&#xA0;</div>
<div class="line"><code class="plain">});</code></div>
</div>
    </div>
    <p>    <span style="color: #58595b;">
While it is possible to write these tests using node without mocha, the structure that mocha uses may be a matter of personal preference. using mocha and the sample script (above), you should see these results:    </span>
    </p>
    <p>    <img src="images/download/attachments/56296174/2.mocha_results.png" alt="images/download/attachments/56296174/2.mocha_results.png" class="confluence-embedded-image">
        </img></p>
    <p>Write test commands for your app. This is where <tt class=" ">webdriver io</tt> stands apart form the rest. Their syntax is shorter and more streamlined than other clients. The  <tt class=" ">webdriver io</tt> API doc can be found <a class="external-link external-link" href="http://webdriver.io/api/action/setValue.html" target="_blank">here</a>.    </p>
    <blockquote>
    <p>Note: The ~ is a unique Appium character that gets attributed to the AccessibilityId used within your Appcelerator app. This one line will find the UI component with AccessibilityId = &#x201C;Enter Username&#x201D; and sets its value:<br>.element(&quot;~Enter Username&quot;).setValue(&quot;testusername&quot;)<br><br>You can refer to the Appium commands <a class="external-link external-link" href="http://appium.io/docs/en/commands/element/find-element/" target="_blank">here</a> if you want more info.    </br></br></br></p>
        </blockquote>
    <p>Update your Appcelerator UI components with Accessibility Features (in this example, this would be the TextField used for the username). See <a class="document-link " href="#!/guide/Accessibility">Appcelerator and Accessibility</a> for more information.    </p>
    <div class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">&lt;</code><code class="keyword">TextField</code><code class="plain"> </code><code class="color1">accessibilityLabel</code><code class="plain">=</code><code class="string">&quot;Enter Username&quot;</code><code class="plain"> /&gt;&#xA0;</code></div>
</div>
    </div>
    <p>Now, you should have mocha configured and a sample test script using <tt class=" ">webdriver io</tt> as the client to interface with your Titanium App (keying off of the <tt class=" ">AccessibilityId</tt>). Before continuing to the final piece (automation) you should ensure your test runs successfully on its own: <tt class=" ">mocha firstapp_test.js</tt>    </p>
    <p>    <span style="color: #444444;">
     </span>
    </p>
    </div>
    </div>
    <div class="section section-2 " id="src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-Automation">
        <h2 class="heading "><span>Automation</span></h2>
    <div class="section section-3 " id="src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-InstallFastlane">
        <h3 class="heading "><span>Install Fastlane</span></h3>
    <p>Review Fastlane&#x2019;s <a class="external-link external-link" href="https://docs.fastlane.tools/" target="_blank">Getting Started Guide</a> to install and init.    </p>
    <p>For each mobile app, you will have a <tt class=" ">fastlane</tt> folder in the root with a few config files.    </p>
    <div class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">-  fastlane (folder)</code></div>
<div class="line"><code class="plain">  - Pluginfile (</code><code class="keyword">this</code><code class="plain"> gets created automatically </code><code class="keyword">for</code><code class="plain"> you)</code></div>
<div class="line"><code class="plain">  - Fastfile (</code><code class="keyword">this</code><code class="plain"> file you create and define the required steps)</code></div>
</div>
    </div>
    <p>As a way to jump start the process, copy the following into your <tt class=" ">Fastfile</tt> file of your app:    </p>
    <div class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">default_platform :ios</code></div>
<div class="line">&#xA0;</div>
<div class="line"><code class="plain">platform :ios </code><code class="keyword">do</code></div>
<div class="line">&#xA0;</div>
<div class="line"><code class="plain">    before_all </code><code class="keyword">do</code></div>
<div class="line"><code class="plain">  	end</code></div>
<div class="line"><code class="plain">  	</code></div>
<div class="line"><code class="plain">  	desc </code><code class="string">&quot;Build App for Simulator Tests&quot;</code></div>
<div class="line"><code class="plain">    lane :buildapp </code><code class="keyword">do</code></div>
<div class="line"><code class="plain">      ti_build_app(</code></div>
<div class="line"><code class="plain">    appc_cli: </code><code class="string">&quot;appc run build --platform ios --target dist-adhoc --distribution-name &apos;implicitli, LLC. (G52GS5PAND)&apos; --pp-uuid c6ea530d-70ea-5661-b013-beb4d25b2a7b --output-dir /dist&quot;</code></div>
<div class="line"><code class="plain">  )</code></div>
<div class="line"><code class="plain">    end</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    desc </code><code class="string">&quot;Runs the tests of the iOS App&quot;</code></div>
<div class="line"><code class="plain">  	lane :test </code><code class="keyword">do</code></div>
<div class="line"><code class="plain">  		ti_build_app(</code></div>
<div class="line"><code class="plain">      		appc_cli: </code><code class="string">&quot;appc run -f -T simulator -p ipad -i 11.2 --device-id 6945AC80-7F29-4A5A-8256-49467E9D1A7D --build-only&quot;</code></div>
<div class="line"><code class="plain">      	)</code></div>
<div class="line"><code class="plain">    	mocha_run_tests(</code></div>
<div class="line"><code class="plain">    		mocha_js_file_name: </code><code class="string">&apos;/Users/{USERDIR}/Appium_Tests/dash_test.js&apos;</code></div>
<div class="line"><code class="plain">    	)</code></div>
<div class="line"><code class="plain">  	end</code></div>
<div class="line"><code class="plain">	</code></div>
<div class="line"><code class="plain">end</code></div>
</div>
    </div>
    <div class="confbox admonition admonition-note aui-message warning shadowed information-macro">
            <p>The Fastfile file doesn&apos;t use file extensions.    </p>
    </div>
        </div>
    <div class="section section-3 " id="src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-ConfigureFastlane">
        <h3 class="heading "><span>Configure Fastlane</span></h3>
    <p>Fastlane runs on what they call &#x2018;lanes&#x2019;. These lanes allow you to break out building, testing, deploying, and so on. Each lane can be run by itself or all together in succession. This is a rather hefty topic and this document only touches on a portion of it. To read more about it, visit <a class="external-link external-link" href="https://docs.fastlane.tools/advanced/" target="_blank">https://docs.fastlane.tools/advanced/</a>.    </p>
    <p>In your Titanium project, run this from terminal: <tt class=" ">fastlane add_plugin ti_build_app</tt>    </p>
    <p>This plugin leverages the full Appcelerator CLI.    </p>
    <p>To add simple runs to your mocha test JavaScript file: <tt class=" ">fastlane add_plugin mocha_run_tests</tt>    </p>
    </div>
    <div class="section section-3 " id="src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-CustomizeYourFastfile">
        <h3 class="heading "><span>Customize Your Fastfile</span></h3>
    <p>In the first lane, <tt class=" ">buildapp</tt>, does just that: It only builds. This defines the distribution type (adhoc) and what cert and provisioning profile to use.    </p>
    <p>One could even go a step further and install the plugin <tt class=" ">ftp</tt> to automate the upload process. Visit <a class="external-link external-link" href="https://docs.fastlane.tools/plugins/available-plugins/" target="_blank">https://docs.fastlane.tools/plugins/available-plugins/</a> for a list of available plugins.    </p>
    <p>The second lane, <tt class=" ">test</tt> has 2 actions:    </p>
<ol class=" "><li class=" ">    <p>Build the app to simulator,    </p>
</li><li class=" ">    <p>test the app.    </p>
</li></ol>    <p>In this example, it uses different Appcelerator CLI commands so that the app is built to a specific simulator and <tt class=" ">--build-only</tt> prevents it from launching (mocha will launch the simulator and attach to the correct session on its own). Then, the next step executes the mocha test file.    </p>
    <div class="confbox admonition admonition-note aui-message warning shadowed information-macro">
            <p>The simulator defined in Fastlane MUST match the simulator defined in my mocha test file.    </p>
    </div>
        </div>
    <div class="section section-3 " id="src-56296174_BuildTestandDeployaTitaniumCross-PlatformAppwithFastlane-ExecuteFastlane">
        <h3 class="heading "><span>Execute Fastlane</span></h3>
    <p>To run the <tt class=" ">test</tt> lane, all one has to do is execute this command: <tt class=" ">bundle exec fastlane test</tt>    </p>
    <p>You will see Appcelerator CLI commands flash across the screen as it builds the app to simulator, then mocha executes, simulator opens, and webdriver io performs all your UI interactions.    </p>
    <p>Example fastlane output:    </p>
    <p>    <img src="images/download/attachments/56296174/3.-fastlane_testlane.png" alt="images/download/attachments/56296174/3.-fastlane_testlane.png" class="confluence-embedded-image">
        </img></p>
    </div>
    </div>
        </div><a id="editButton" href="https://wiki.appcelerator.org/pages/editpage.action?pageId=56296174"><span>Edit</span></a>
    
        
    </div>
</body>
</html>
